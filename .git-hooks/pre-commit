#!/usr/bin/env sh
# Enable pipefail only if the shell supports it (bash, zsh, ksh); harmless on dash.
case "$(set -o 2>/dev/null)" in
  *" pipefail "*) set -o pipefail ;;
esac
set -eu

echo "Running clang-formatâ€¦"

# Always go to repo root (safe)
cd "$(git rev-parse --show-toplevel)"

# Run make in src/
make -C src format

# Re-stage any changes made by formatting
if ! git diff --quiet; then
  echo "pre-commit: Formatting changed files."
  git add -A
fi
